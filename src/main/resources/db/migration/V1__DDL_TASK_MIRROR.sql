CREATE TABLE tbl_usuarios (
id_usuario NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
username VARCHAR2(100) NOT NULL UNIQUE,
password VARCHAR2(255) NOT NULL,
role_usuario VARCHAR2(100) NOT NULL,
funcao VARCHAR2(100) NOT NULL,
ativo NUMBER(1) DEFAULT 1 NOT NULL,
cargo VARCHAR2(100) NOT NULL,
setor VARCHAR2(100) NOT NULL,
id_lider NUMBER NULL,
CONSTRAINT fk_usuarios_lider FOREIGN KEY (id_lider) REFERENCES tbl_usuarios(id_usuario) ON DELETE SET NULL
);

-- TABELA DE TIPOS DE TAREFA
CREATE TABLE tbl_tipo_tarefa (
id_tipo_tarefa NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
nome VARCHAR2(100) NOT NULL
);

-- TABELA STATUS TAREFA
CREATE TABLE tbl_status_tarefa (
id_status_tarefa NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
nome VARCHAR2(100) NOT NULL
);

-- TABELA DE TAREFAS
CREATE TABLE tbl_tarefas (
id_tarefa NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
id_usuario NUMBER NOT NULL,
id_lider NUMBER NOT NULL,
id_tipo_tarefa NUMBER NOT NULL,
id_status_tarefa NUMBER NOT NULL,
descricao VARCHAR2(500),
tempo_estimado NUMBER(5,2),
tempo_real NUMBER(5,2),
data_inicio TIMESTAMP WITH TIME ZONE,
data_fim TIMESTAMP WITH TIME ZONE NULL,
CONSTRAINT fk_tarefas_usuario FOREIGN KEY (id_usuario)REFERENCES tbl_usuarios(id_usuario),
CONSTRAINT fk_tarefas_lider FOREIGN KEY (id_lider)REFERENCES tbl_usuarios(id_usuario),
CONSTRAINT fk_tarefas_tipo FOREIGN KEY (id_tipo_tarefa)REFERENCES tbl_tipo_tarefa(id_tipo_tarefa),
CONSTRAINT fk_tarefas_status FOREIGN KEY (id_status_tarefa)REFERENCES tbl_status_tarefa(id_status_tarefa)
);

-- TABELA DE FEEDBACKS
CREATE TABLE tbl_feedbacks (
id_feedback NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1 PRIMARY KEY,
id_tarefa NUMBER UNIQUE NOT NULL,
conteudo CLOB NOT NULL,
data_gerado TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
CONSTRAINT fk_feedback_tarefa FOREIGN KEY (id_tarefa) REFERENCES tbl_tarefas(id_tarefa) ON DELETE CASCADE
);

-- TABELA DE AUDITORIA DE ACOES
CREATE TABLE tbl_auditoria (
id_auditoria NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
nome_tabela VARCHAR2(100 CHAR) NOT NULL,
tipo_operacao VARCHAR2(10 CHAR) NOT NULL,
usuario VARCHAR2(100 CHAR) DEFAULT USER,
data_operacao TIMESTAMP DEFAULT SYSTIMESTAMP,
valores_antigos CLOB,
valores_novos CLOB
);